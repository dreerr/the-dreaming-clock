<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>The Dreaming Clock</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
    <style>
      .preview-container {
        background: rgba(0, 0, 0, 0.8);
        border-radius: 16px;
        padding: 20px;
        margin: 20px auto;
        max-width: 500px;
      }
      #clock-preview {
        width: 100%;
        height: auto;
      }
      .segment {
        fill: #111;
        transition: fill 0.05s ease;
      }
      .ws-status {
        text-align: center;
        font-size: 12px;
        color: #888;
        margin-top: 10px;
      }
      .ws-status.connected { color: #4caf50; }
      .ws-status.disconnected { color: #f44336; }
    </style>
  </head>
  <body>
    <div class="center">
      <h1>‚è∞ The Dreaming Clock</h1>

      <!-- Live Preview -->
      <div class="preview-container">
        <svg id="clock-preview" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 3685 1502.4">
          <g id="digit3">
            <polygon id="seg27" class="segment" points="3370.3 669.3 3416.9 737 3484.9 681.9 3543.3 294.7 3497.8 239.3 3425.7 306.8 3370.3 669.3"/>
            <polygon id="seg26" class="segment" points="3021.9 270.2 2957.4 213.7 3011.2 155.9 3440 155.9 3480.3 213.7 3415.8 270.2 3021.9 270.2"/>
            <polygon id="seg25" class="segment" points="2937.3 679.3 2873.6 731.6 2822.7 672.2 2884.8 273 2930.5 233.9 2995.9 289.1 2937.3 679.3"/>
            <polygon id="seg24" class="segment" points="2941.3 810.5 2894.9 752.7 2961.4 696.3 3349.9 696.3 3390.2 754.1 3327.1 810.5 2941.3 810.5"/>
            <polygon id="seg23" class="segment" points="3286.3 1207.6 3332.9 1275.3 3400.9 1220.3 3461.3 831 3415.8 775.6 3343.7 843.1 3286.3 1207.6"/>
            <polygon id="seg22" class="segment" points="2857.3 1348.9 2814.2 1292.4 2877.4 1234.7 3265.9 1234.7 3306.3 1292.4 3243.1 1348.9 2857.3 1348.9"/>
            <polygon id="seg21" class="segment" points="2853.3 1217.6 2793.6 1269.9 2738.7 1210.6 2800.1 823.5 2870.7 772.3 2913.9 827.5 2853.3 1217.6"/>
          </g>
          <g id="digit2">
            <polygon id="seg20" class="segment" points="2616 669.3 2662.7 737 2730.7 681.9 2789.1 294.7 2743.6 239.3 2671.5 306.8 2616 669.3"/>
            <polygon id="seg19" class="segment" points="2267.7 270.2 2203.2 213.7 2257 155.9 2685.8 155.9 2726.1 213.7 2661.6 270.2 2267.7 270.2"/>
            <polygon id="seg18" class="segment" points="2183.1 679.3 2119.3 731.6 2068.5 672.2 2130.6 273 2176.3 233.9 2241.7 289.1 2183.1 679.3"/>
            <polygon id="seg17" class="segment" points="2187.1 810.5 2140.7 752.7 2207.2 696.3 2595.7 696.3 2636 754.1 2572.8 810.5 2187.1 810.5"/>
            <polygon id="seg16" class="segment" points="2532.1 1207.6 2578.6 1275.3 2646.7 1220.3 2707.1 831 2661.6 775.6 2589.5 843.1 2532.1 1207.6"/>
            <polygon id="seg15" class="segment" points="2103 1348.9 2060 1292.4 2123.2 1234.7 2511.7 1234.7 2552 1292.4 2488.9 1348.9 2103 1348.9"/>
            <polygon id="seg14" class="segment" points="2099 1217.6 2039.4 1269.9 1984.5 1210.6 2045.9 823.5 2116.5 772.3 2159.6 827.5 2099 1217.6"/>
          </g>
          <g id="colon">
            <path id="seg28b" class="segment" d="M1802.7,1070.9c27.4,0,49.7-22.2,49.7-49.7s-22.3-49.7-49.7-49.7-49.7,22.2-49.7,49.7,22.2,49.7,49.7,49.7Z"/>
            <path id="seg28" class="segment" d="M1883.2,530.6c27.4,0,49.7-22.3,49.7-49.7s-22.3-49.7-49.7-49.7-49.7,22.3-49.7,49.7,22.2,49.7,49.7,49.7Z"/>
          </g>
          <g id="digit1">
            <polygon id="seg13" class="segment" points="1527.5 669.3 1574.1 737 1642.1 681.9 1700.5 294.7 1655 239.3 1583 306.8 1527.5 669.3"/>
            <polygon id="seg12" class="segment" points="1179.1 270.2 1114.6 213.7 1168.4 155.9 1597.2 155.9 1637.6 213.7 1573 270.2 1179.1 270.2"/>
            <polygon id="seg11" class="segment" points="1094.5 679.3 1030.8 731.6 980 672.2 1042 273 1087.7 233.9 1153.1 289.1 1094.5 679.3"/>
            <polygon id="seg10" class="segment" points="1098.5 810.5 1052.1 752.7 1118.7 696.3 1507.2 696.3 1547.5 754.1 1484.3 810.5 1098.5 810.5"/>
            <polygon id="seg9" class="segment" points="1443.5 1207.6 1490.1 1275.3 1558.1 1220.3 1618.5 831 1573 775.6 1500.9 843.1 1443.5 1207.6"/>
            <polygon id="seg8" class="segment" points="1014.5 1348.9 971.5 1292.4 1034.6 1234.7 1423.1 1234.7 1463.5 1292.4 1400.3 1348.9 1014.5 1348.9"/>
            <polygon id="seg7" class="segment" points="1010.5 1217.6 950.8 1269.9 896 1210.6 957.3 823.5 1027.9 772.3 1071.1 827.5 1010.5 1217.6"/>
          </g>
          <g id="digit0">
            <polygon id="seg6" class="segment" points="773.3 669.3 819.9 737 887.9 681.9 946.3 294.7 900.8 239.3 828.7 306.8 773.3 669.3"/>
            <polygon id="seg5" class="segment" points="424.9 270.2 360.4 213.7 414.2 155.9 843 155.9 883.3 213.7 818.8 270.2 424.9 270.2"/>
            <polygon id="seg4" class="segment" points="340.3 679.3 276.6 731.6 225.8 672.2 287.8 273 333.5 233.9 398.9 289.1 340.3 679.3"/>
            <polygon id="seg3" class="segment" points="344.3 810.5 297.9 752.7 364.4 696.3 752.9 696.3 793.3 754.1 730.1 810.5 344.3 810.5"/>
            <polygon id="seg2" class="segment" points="705.7 1207.6 752.3 1275.3 820.3 1220.3 880.8 831 835.2 775.6 763.2 843.1 705.7 1207.6"/>
            <polygon id="seg1" class="segment" points="260.3 1348.9 217.3 1292.4 280.4 1234.7 668.9 1234.7 709.3 1292.4 646.1 1348.9 260.3 1348.9"/>
            <polygon id="seg0" class="segment" points="256.3 1217.6 196.6 1269.9 141.7 1210.6 203.1 823.5 273.7 772.3 316.9 827.5 256.3 1217.6"/>
          </g>
        </svg>
        <div id="ws-status" class="ws-status disconnected">‚ö´ Connecting...</div>
      </div>

      <svg
        class="button"
        onclick="wakeup()"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        version="1.1"
        x="0px"
        y="0px"
        viewBox="0 0 100 100"
        enable-background="new 0 0 100 100"
        fill="white"
        xml:space="preserve"
      >
        <path
          d="M41.463,69.262c0.123-0.845,0.209-1.691,0.228-2.533c0.006-0.269-0.097-0.529-0.285-0.722  c-0.188-0.192-0.445-0.301-0.715-0.301H6.721c-0.27,0-0.527,0.108-0.715,0.301c-0.188,0.192-0.291,0.453-0.285,0.722  c0.18,7.817,5.014,16.023,11.368,19.507v2.26c0,0.553,0.447,1,1,1H29.13c0.553,0,1-0.447,1-1V86.34  c2.064-1.096,3.968-2.687,5.615-4.609c0.87,0.675,1.952,1.1,3.15,1.213c0.226,0.021,0.453,0.032,0.682,0.032  c1.959,0,3.995-0.772,5.681-2.173c1.625-1.346,2.744-3.118,3.151-4.99c0.426-1.96,0.031-3.798-1.11-5.176  C45.918,68.964,43.666,68.499,41.463,69.262z M19.089,87.495v-0.76h9.041v0.76H19.089z M28.909,84.735H18.502  c-5.621-2.816-10.17-10.102-10.729-17.029h31.865C39.079,74.629,34.529,81.914,28.909,84.735z M46.453,75.387  c-0.312,1.438-1.189,2.813-2.473,3.875c-1.478,1.228-3.267,1.845-4.898,1.689c-0.821-0.077-1.534-0.348-2.102-0.788  c1.811-2.508,3.199-5.42,3.985-8.44c1.767-1.136,3.743-1.084,4.792,0.188C46.499,72.806,46.746,74.04,46.453,75.387z"
        />
        <path
          d="M95.347,63.797l-18-14.461l-3.199-4.512l-1.674-3.977c7.617-8.819,8.343-21.554,1.68-31.213  c-0.152-0.221-0.386-0.371-0.649-0.417c-0.265-0.05-0.535,0.014-0.752,0.169L62.04,16.984c-0.552-0.529-1.237-0.912-1.996-1.069  c-1.106-0.227-2.271,0.017-3.194,0.671l-8.973,6.371l-2.591-5.029c-0.133-0.258-0.37-0.445-0.652-0.514  c-0.281-0.068-0.579-0.012-0.814,0.156l-5.507,3.906c-0.236,0.167-0.389,0.43-0.417,0.718s0.069,0.575,0.269,0.785l3.892,4.111  L31.3,34.727c-0.45,0.319-0.556,0.944-0.236,1.395c0.195,0.274,0.503,0.421,0.816,0.421c0.2,0,0.402-0.06,0.578-0.185l25.55-18.141  c0.478-0.34,1.057-0.461,1.633-0.343c0.261,0.054,0.501,0.159,0.716,0.3L32.908,37.642c-0.004,0.003-0.006,0.008-0.01,0.011  l-4.944,3.507c-0.308,0.218-0.467,0.591-0.411,0.963c0.056,0.373,0.316,0.684,0.675,0.802l13.757,4.559l12.491,11.299l3.2,4.512  l7.698,21.769c0.104,0.296,0.341,0.525,0.641,0.62c0.099,0.031,0.2,0.047,0.302,0.047c0.205,0,0.407-0.063,0.578-0.185L95.3,65.393  c0.256-0.182,0.412-0.472,0.422-0.785C95.729,64.293,95.592,63.993,95.347,63.797z M40.408,22.441l3.627-2.573l2.195,4.258  l-2.527,1.794L40.408,22.441z M71.383,54.962l14.16,14.897l-11.217,7.956l-9.378-18.289L71.383,54.962z M58.799,61.436L56.61,58.35  l16.42-11.646l2.188,3.086L58.799,61.436z M64.944,22.954l6.303-4.47c1.566,5.089,0.913,10.714-1.744,15.304L64.944,22.954z   M72.035,44.959l-3.21,2.277L56.163,23.603l5.301-3.76L72.035,44.959z M60.147,53.39L42.031,33.627l12.487-8.857L67.18,48.402  L60.147,53.39z M40.386,34.793l18.116,19.763l-3.209,2.276L35.084,38.554L40.386,34.793z M73.065,11.615  c5.359,8.509,4.747,19.333-1.463,27.16l-1.153-2.739c3.846-5.667,4.716-13.08,2.239-19.499c-0.11-0.287-0.349-0.508-0.644-0.597  c-0.295-0.09-0.615-0.036-0.867,0.142l-7.028,4.985l-1.014-2.409L73.065,11.615z M30.723,41.647l2.691-1.908l4.885,4.419  L30.723,41.647z M66.807,83.147l-7.051-19.939l3.544-2.514l9.378,18.289L66.807,83.147z M87.191,68.691l-14.16-14.897l3.544-2.514  l16.487,13.246L87.191,68.691z"
        />
        <path
          d="M17.938,60.211c0.553,0,1-0.447,1-1c0-7.46,3.357-14.397,9.212-19.034c0.433-0.343,0.506-0.972,0.163-1.405  s-0.972-0.507-1.405-0.163c-6.336,5.019-9.97,12.528-9.97,20.603C16.938,59.764,17.385,60.211,17.938,60.211z M26.188,44.356  c-0.448-0.321-1.073-0.217-1.395,0.232c-3.711,5.191-4.827,11.683-3.063,17.809c0.126,0.438,0.526,0.724,0.961,0.724  c0.091,0,0.185-0.013,0.276-0.039c0.531-0.152,0.838-0.707,0.685-1.237c-1.594-5.536-0.585-11.401,2.769-16.094  C26.741,45.302,26.638,44.678,26.188,44.356z"
        />
      </svg>
      <p id="status"></p>
      <a href="/settings" class="link">‚öôÔ∏è Settings</a>
    </div>
    <script>
      // WebSocket for LED preview
      let ws;
      let reconnectTimer;

      function connectWebSocket() {
        const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
        ws = new WebSocket(protocol + '//' + location.host + '/ws/leds');
        ws.binaryType = 'arraybuffer';

        ws.onopen = () => {
          document.getElementById('ws-status').textContent = 'üü¢ Live';
          document.getElementById('ws-status').className = 'ws-status connected';
          if (reconnectTimer) clearTimeout(reconnectTimer);
        };

        ws.onclose = () => {
          document.getElementById('ws-status').textContent = 'üî¥ Disconnected';
          document.getElementById('ws-status').className = 'ws-status disconnected';
          reconnectTimer = setTimeout(connectWebSocket, 2000);
        };

        ws.onerror = () => {
          ws.close();
        };

        ws.onmessage = (event) => {
          if (event.data instanceof ArrayBuffer) {
            const data = new Uint8Array(event.data);
            updatePreview(data);
          }
        };
      }

      function updatePreview(data) {
        // data: 29 segments √ó 3 bytes (RGB)
        for (let seg = 0; seg < 29; seg++) {
          const r = data[seg * 3];
          const g = data[seg * 3 + 1];
          const b = data[seg * 3 + 2];
          const color = `rgb(${r}, ${g}, ${b})`;

          if (seg === 28) {
            // Colon - two circles
            const el1 = document.getElementById('seg28');
            const el2 = document.getElementById('seg28b');
            if (el1) el1.style.fill = color;
            if (el2) el2.style.fill = color;
          } else {
            const el = document.getElementById('seg' + seg);
            if (el) el.style.fill = color;
          }
        }
      }

      // Start WebSocket connection
      connectWebSocket();

      function wakeup() {
        fetch('/wakeup', { method: 'POST' })
          .then(r => r.json())
          .then(data => {
            document.getElementById('status').textContent = data.success ? '‚úì Clock woken!' : '‚úó Failed';
            setTimeout(() => { document.getElementById('status').textContent = ''; }, 3000);
          })
          .catch(e => {
            document.getElementById('status').textContent = '‚úó Error';
          });
        }
    </script>
  </body>
</html>